!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.leafletMap=t():e.leafletMap=t()}(window,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);class o extends L.Marker{constructor(e,t){super(e,t)}setData(e){this.data=e}getData(){return this.data}}t.default={MarkersLayer:class{constructor(e,t,n,o){this.map=e,this.dataList=t,this.options=n,this.channelFunc=o,this.layer=null,this.focusedMarker=null,this.hoveredMarker=null,this.focusedDisplayMarker=null,this.markers=[],this.markerLayer=null,this.heatLayer=null,this.segmentedMin=1/0,this.segmentedStep=1,this.initLayer()}draw(e){return this.redraw(e)}redraw(e){switch(this.layer&&this.layer.removeFrom(this.map),this.options=Object.assign(this.options,e),this.options.renderType){case"point":this.renderMarkerToPoint();break;case"heat":this.renderMarkerToHeat();break;default:throw new Error(`renderType 不支持"${this.options.renderType}"`)}return this.layer.addTo(this.map),this}setOptions(e,t=!1){this.options=Object.assign(this.options,e),t&&this.redraw()}initLayer(){this.dataList.forEach(e=>{let t=L.geoJSON(e.geometry).getLayers()[0];(t=new o([t.getLatLng().lng,t.getLatLng().lat],{icon:this.getMarkerIcon(e)})).setData(e),this.markers.push(t),this.cacheSegmentParams()})}markerClickHandler(e){this.focusedMarker=e,this.focusedDisplayMarker&&this.focusedDisplayMarker.removeFrom(this.map),this.focusedDisplayMarker=new o(e.getLatLng(),{icon:this.getLargerMarkerIcon(e.getData())}),this.focusedDisplayMarker.addTo(this.map),this.map.panTo(this.focusedMarker.getLatLng()),this.channelFunc("on-click-marker",e)}renderMarkerToPoint(){const e=L.canvasIconLayer({}).addTo(this.map);e.addOnClickListener((e,[{data:t}])=>{this.markerClickHandler(t)}),e.addOnHoverListener((e,[{data:t}])=>{this.hoveredMarker&&this.hoveredMarker.closeTooltip(),this.hoveredMarker=t,this.hoveredMarker.getTooltip()?this.hoveredMarker.openTooltip():this.options.tooltipAttr&&this.hoveredMarker.bindTooltip(""+this.hoveredMarker.getData()[this.options.tooltipAttr],{permanent:!0})}),e.addMarkers(this.markers),this.map.panTo(this.map.getCenter()),this.markerLayer=e,this.layer=this.markerLayer}renderMarkerToHeat(){this.markers.forEach(e=>{const t=e.getLatLng();let n=e.getData()[this.options.heatOptions.dimensionAttr];"number"!=typeof n&&(n=this.options.heatOptions.max),e.setLatLng(L.latLng(t.lat,t.lng,n))}),this.heatLayer=L.heatLayer(this.markers.map(e=>e.getLatLng()),this.options.heatOptions),this.layer=this.heatLayer}getLargerMarkerIcon(e){return this._getMarkerIcon(e,!0)}getMarkerIcon(e){return this._getMarkerIcon(e,!1)}_getMarkerIcon(e,t){let n=this.options.iconSize,o=this.options.iconAnchor;n=t?[1.5*n[0],1.5*n[1]]:n,o=t?[1.5*o[0],1.5*o[1]]:o;const r=this.options.iconColor;switch(this.options.iconType){case"image":return L.icon({iconUrl:this.options.iconImageUrl,iconSize:n,iconAnchor:o});case"font_class":case"symbol":case"unicode":return L.divIcon({html:this.getCustomIconHTML(e,{iconSize:n,iconColor:r}),className:t?"large-div-icon-marker":"",iconSize:n,iconAnchor:o});default:throw new Error(`图标类型不支持"${this.options.iconType}"`)}}getCustomIconHTML(e,t){if(this.options.iconRenderer)return t=Object.assign({},this.options,t),this.options.iconRenderer(e,t);switch(this.options.renderPointColorType){case"single":switch(this.options.iconType){case"font_class":return`\n              <i class="${this.options.iconClass}"\n                style="\n                  color: ${t.iconColor};\n                  font-size: ${t.iconSize}px;\n                "\n                />\n            `;case"symbol":return`\n              <svg class="icon-symbol" aria-hidden="true">\n                <use xlink:href="${this.options.iconSymbol}" />\n              </svg>\n            `;case"unicode":return`\n              <i\n                class="${this.options.iconClass}"\n                style="\n                  color: ${t.iconColor};\n                  font-size: ${t.iconSize[0]}px;\n                "\n                >\n                ${this.options.iconUnicode}\n              </i>\n            `}case"segmented":switch(this.options.iconType){case"font_class":return`\n              <i\n                class="${this.options.iconClass}"\n                style="\n                  color: ${this.getSegmentedMarkerColor(e)};\n                  font-size: ${t.iconSize}px;\n                "\n                />\n            `;case"symbol":return`\n              <svg class="icon-symbol" aria-hidden="true">\n                <use xlink:href="${this.options.iconSymbol}" />\n              </svg>\n            `;case"unicode":return`\n              <i\n                class="${this.options.iconClass}"\n                style="\n                  color: ${this.getSegmentedMarkerColor(e)};\n                  font-size: ${t.iconSize}px;\n                "\n                >\n                &#${this.options.iconUnicode}\n              </i>\n            `}default:throw new Error(`renderPointColorType 不支持"${this.options.renderPointColorType}"`)}}cacheSegmentParams(){const e=this.options.segmentedColors.length;let t=-1/0,n=1/0;for(const e of this.markers){const o=e.getData()[this.options.segmentedAttr];t=Math.max(t,o),n=Math.min(n,o)}const o=(t-n+1)/e;this.segmentedMin=n,this.segmentedStep=o}getSegmentedMarkerColor(e){const t=e[this.options.segmentedAttr];return this.options.segmentedColors[(t-this.segmentedMin)/this.segmentedStep]}},Marker:o}}])});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9sZWFmbGV0TWFwL3dlYnBhY2svdW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbiIsIndlYnBhY2s6Ly9sZWFmbGV0TWFwL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL2xlYWZsZXRNYXAvLi9zcmMvbWFya2VyL01hcmtlci50cyIsIndlYnBhY2s6Ly9sZWFmbGV0TWFwLy4vc3JjL2luZGV4LnRzIiwid2VicGFjazovL2xlYWZsZXRNYXAvLi9zcmMvbWFya2VyL01hcmtlcnNMYXllci50cyJdLCJuYW1lcyI6WyJyb290IiwiZmFjdG9yeSIsImV4cG9ydHMiLCJtb2R1bGUiLCJkZWZpbmUiLCJhbWQiLCJ3aW5kb3ciLCJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiTWFya2VyIiwiTCIsIltvYmplY3QgT2JqZWN0XSIsImxhdGxuZyIsIm9wdGlvbnMiLCJzdXBlciIsImRhdGEiLCJ0aGlzIiwiX193ZWJwYWNrX2V4cG9ydHNfXyIsIk1hcmtlcnNMYXllciIsIm1hcCIsImRhdGFMaXN0IiwiY2hhbm5lbEZ1bmMiLCJsYXllciIsImZvY3VzZWRNYXJrZXIiLCJob3ZlcmVkTWFya2VyIiwiZm9jdXNlZERpc3BsYXlNYXJrZXIiLCJtYXJrZXJzIiwibWFya2VyTGF5ZXIiLCJoZWF0TGF5ZXIiLCJzZWdtZW50ZWRNaW4iLCJJbmZpbml0eSIsInNlZ21lbnRlZFN0ZXAiLCJpbml0TGF5ZXIiLCJyZWRyYXciLCJyZW1vdmVGcm9tIiwiYXNzaWduIiwicmVuZGVyVHlwZSIsInJlbmRlck1hcmtlclRvUG9pbnQiLCJyZW5kZXJNYXJrZXJUb0hlYXQiLCJFcnJvciIsImFkZFRvIiwiZm9yRWFjaCIsIm1hcmtlciIsImdlb0pTT04iLCJnZW9tZXRyeSIsImdldExheWVycyIsImdldExhdExuZyIsImxuZyIsImxhdCIsImljb24iLCJnZXRNYXJrZXJJY29uIiwic2V0RGF0YSIsInB1c2giLCJjYWNoZVNlZ21lbnRQYXJhbXMiLCJnZXRMYXJnZXJNYXJrZXJJY29uIiwiZ2V0RGF0YSIsInBhblRvIiwiY2FudmFzSWNvbkxheWVyIiwiYWRkT25DbGlja0xpc3RlbmVyIiwiXyIsIm1hcmtlckNsaWNrSGFuZGxlciIsImFkZE9uSG92ZXJMaXN0ZW5lciIsImNsb3NlVG9vbHRpcCIsImdldFRvb2x0aXAiLCJvcGVuVG9vbHRpcCIsInRvb2x0aXBBdHRyIiwiYmluZFRvb2x0aXAiLCJwZXJtYW5lbnQiLCJhZGRNYXJrZXJzIiwiZ2V0Q2VudGVyIiwibGF0TG5nIiwiYWx0IiwiaGVhdE9wdGlvbnMiLCJkaW1lbnNpb25BdHRyIiwibWF4Iiwic2V0TGF0TG5nIiwiaXQiLCJfZ2V0TWFya2VySWNvbiIsImlzTGFyZ2VyIiwiaWNvblNpemUiLCJpY29uQW5jaG9yIiwiaWNvbkNvbG9yIiwiaWNvblR5cGUiLCJpY29uVXJsIiwiaWNvbkltYWdlVXJsIiwiZGl2SWNvbiIsImh0bWwiLCJnZXRDdXN0b21JY29uSFRNTCIsImNsYXNzTmFtZSIsImljb25SZW5kZXJlciIsInJlbmRlclBvaW50Q29sb3JUeXBlIiwiaWNvbkNsYXNzIiwiaWNvblN5bWJvbCIsImljb25Vbmljb2RlIiwiZ2V0U2VnbWVudGVkTWFya2VyQ29sb3IiLCJzZWdtZW50ZWRMZW5ndGgiLCJzZWdtZW50ZWRDb2xvcnMiLCJsZW5ndGgiLCJtYXhWYWwiLCJtaW5WYWwiLCJ2YWwiLCJzZWdtZW50ZWRBdHRyIiwi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QUssVUFDSCxvREFFYTVFLEtBQUtILFFBQVE4RSxpRUFFWDNFLEtBQUs4RSx3QkFBd0IvRSxxQ0FDekJGLEVBQVFrRSx3RUFHbkIvRCxLQUFLSCxRQUFRZ0YsZ0RBTTNCLFFBQ0UsTUFBTSxJQUFJdEQsa0NBQ29CdkIsS0FBS0gsUUFBUTZFLDBCQUt6Qy9FLHFCQUNOLE1BQU1vRixFQUFrQi9FLEtBQUtILFFBQVFtRixnQkFBZ0JDLE9BQ3JELElBQUlDLEdBQVMsSUFDVEMsRUFBU3JFLElBQ2IsSUFBSyxNQUFNWSxLQUFVMUIsS0FBS1UsUUFBUyxDQUNqQyxNQUFNMEUsRUFBTTFELEVBQU9hLFVBQVV2QyxLQUFLSCxRQUFRd0YsZUFDMUNILEVBQVNJLEtBQUs1QixJQUFJd0IsRUFBUUUsR0FDMUJELEVBQVNHLEtBQUtDLElBQUlKLEVBQVFDLEdBRTVCLE1BQU1JLEdBQVFOLEVBQVNDLEVBQVMsR0FBS0osRUFDckMvRSxLQUFLYSxhQUFlc0UsRUFDcEJuRixLQUFLZSxjQUFnQnlFLEVBRWY3Rix3QkFBd0JJLEdBQzlCLE1BQU1xRixFQUFNckYsRUFBS0MsS0FBS0gsUUFBUXdGLGVBSTlCLE9BSGNyRixLQUFLSCxRQUFRbUYsaUJBQ3hCSSxFQUFNcEYsS0FBS2EsY0FBZ0JiLEtBQUtlLGlCRDdXckN0QiIsImZpbGUiOiJsZWFmbGV0LW1hcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShbXSwgZmFjdG9yeSk7XG5cdGVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKVxuXHRcdGV4cG9ydHNbXCJsZWFmbGV0TWFwXCJdID0gZmFjdG9yeSgpO1xuXHRlbHNlXG5cdFx0cm9vdFtcImxlYWZsZXRNYXBcIl0gPSBmYWN0b3J5KCk7XG59KSh3aW5kb3csIGZ1bmN0aW9uKCkge1xucmV0dXJuICIsIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImltcG9ydCB7IERhdGFMaXN0SXRlbSB9IGZyb20gJy4uL2RlZmluaXRpb25zJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNYXJrZXIgZXh0ZW5kcyBMLk1hcmtlciB7XG4gIHByaXZhdGUgZGF0YTogRGF0YUxpc3RJdGVtXG4gIGNvbnN0cnVjdG9yKGxhdGxuZzogTC5MYXRMbmdFeHByZXNzaW9uLCBvcHRpb25zPzogTC5NYXJrZXJPcHRpb25zKSB7XG4gICAgc3VwZXIobGF0bG5nLCBvcHRpb25zKVxuICB9XG4gIHB1YmxpYyBzZXREYXRhKGRhdGE6IERhdGFMaXN0SXRlbSkge1xuICAgIHRoaXMuZGF0YSA9IGRhdGFcbiAgfVxuICBwdWJsaWMgZ2V0RGF0YSgpIHtcbiAgICByZXR1cm4gdGhpcy5kYXRhXG4gIH1cbn1cbiIsImltcG9ydCBNYXJrZXIgZnJvbSAnLi9tYXJrZXIvTWFya2VyJ1xuaW1wb3J0IE1hcmtlcnNMYXllciBmcm9tICcuL21hcmtlci9NYXJrZXJzTGF5ZXInXG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgTWFya2Vyc0xheWVyLFxuICBNYXJrZXIsXG59XG4iLCJpbXBvcnQgeyBEYXRhTGlzdEl0ZW0sIENoYW5uZWxGdW5jIH0gZnJvbSAnLi4vZGVmaW5pdGlvbnMnXG5pbXBvcnQgTWFya2VyIGZyb20gJy4vTWFya2VyJ1xuXG4vKiog5riy5p+T5qC35byPIOaVo+eCuXzng63lipvlm74gKi9cbnR5cGUgTWFya2Vyc0xheWVyUmVuZGVyVHlwZSA9ICdwb2ludCcgfCAnaGVhdCdcblxuLyoqIOa4suafk+minOiJsuagt+W8jyDljZXoibJ85YiG5q61ICovXG50eXBlIE1hcmtlcnNMYXllclJlbmRlclBvaW50Q29sb3JUeXBlID0gJ3NpbmdsZScgfCAnc2VnbWVudGVkJ1xuXG4vKiog5pWj54K55Zu+5qCH57G75Z6LIGljb25mb250fHN2Z3xpbWFnZSAqL1xudHlwZSBNYXJrZXJzTGF5ZXJJY29uVHlwZSA9ICdmb250X2NsYXNzJyB8ICd1bmljb2RlJyB8ICdzeW1ib2wnIHwgJ2ltYWdlJ1xuXG5pbnRlcmZhY2UgSWNvblJlbmRlckZ1bmNPcHRpb24ge1xuICBpY29uU2l6ZTogW251bWJlciwgbnVtYmVyXVxuICBpY29uQ29sb3I6IHN0cmluZ1xufVxudHlwZSBJY29uUmVuZGVyRnVuYyA9IChcbiAgZGF0YTogRGF0YUxpc3RJdGVtLFxuICBwYXJhbXM6IEljb25SZW5kZXJGdW5jT3B0aW9uXG4pID0+IHN0cmluZ1xuXG5leHBvcnQgaW50ZXJmYWNlIE1hcmtlcnNMYXllck9wdGlvbnMge1xuICByZW5kZXJUeXBlOiBNYXJrZXJzTGF5ZXJSZW5kZXJUeXBlXG4gIHJlbmRlclBvaW50Q29sb3JUeXBlOiBNYXJrZXJzTGF5ZXJSZW5kZXJQb2ludENvbG9yVHlwZVxuICBpY29uVHlwZTogTWFya2Vyc0xheWVySWNvblR5cGVcblxuICBpY29uSW1hZ2VVcmw/OiBzdHJpbmdcbiAgaWNvblNpemU/OiBbbnVtYmVyLCBudW1iZXJdXG4gIGljb25DbGFzcz86IHN0cmluZ1xuICBpY29uVW5pY29kZT86IHN0cmluZ1xuICBpY29uU3ltYm9sPzogc3RyaW5nXG4gIGljb25Db2xvcj86IHN0cmluZ1xuICBpY29uQW5jaG9yPzogW251bWJlciwgbnVtYmVyXVxuICBpY29uUmVuZGVyZXI/OiBJY29uUmVuZGVyRnVuY1xuXG4gIGNsdXN0ZXI6IGJvb2xlYW5cblxuICAvKiogcG9wdXAg5bGV56S65a2X5q61ICovXG4gIHBvcHVwQXR0cj86IHN0cmluZ1xuICAvKiogdG9vbHRpcCDlsZXnpLrlrZfmrrUgKi9cbiAgdG9vbHRpcEF0dHI/OiBzdHJpbmdcblxuICBvcGFjaXR5PzogbnVtYmVyXG5cbiAgLyoqIOWIhuautea4suafk+e7n+iuoeWtl+autSAqL1xuICBzZWdtZW50ZWRBdHRyPzogc3RyaW5nXG4gIHNlZ21lbnRlZENvbG9ycz86IHN0cmluZ1tdXG5cbiAgaGVhdE9wdGlvbnM/OiBNYXJrZXJzSGVhdExheWVyT3B0aW9uc1xufVxuXG4vKiog6L2s5YyW5Li654Ot5Yqb5Zu+55qEIG9wdGlvbnMgKi9cbmludGVyZmFjZSBNYXJrZXJzSGVhdExheWVyT3B0aW9ucyBleHRlbmRzIEwuSGVhdExheWVyT3B0aW9ucyB7XG4gIGRpbWVuc2lvbkF0dHI6IHN0cmluZ1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNYXJrZXJzTGF5ZXIge1xuICBwcml2YXRlIG1hcDogTC5NYXBcbiAgcHJpdmF0ZSBkYXRhTGlzdDogRGF0YUxpc3RJdGVtW11cbiAgcHJpdmF0ZSBvcHRpb25zOiBNYXJrZXJzTGF5ZXJPcHRpb25zXG4gIHByaXZhdGUgY2hhbm5lbEZ1bmM6IENoYW5uZWxGdW5jXG5cbiAgcHJpdmF0ZSBsYXllcjogTC5DYW52YXNJY29uTGF5ZXIgfCBMLkhlYXRMYXllclxuICBwcml2YXRlIGZvY3VzZWRNYXJrZXI6IE1hcmtlclxuICBwcml2YXRlIGhvdmVyZWRNYXJrZXI6IE1hcmtlclxuICAvKiog6ZyA6KaB5bGV56S655qE5pS+5aSn55qE5Zu+5qCHICovXG4gIHByaXZhdGUgZm9jdXNlZERpc3BsYXlNYXJrZXI6IE1hcmtlclxuICBwcml2YXRlIG1hcmtlcnM6IE1hcmtlcltdXG4gIHByaXZhdGUgbWFya2VyTGF5ZXI6IEwuQ2FudmFzSWNvbkxheWVyXG4gIHByaXZhdGUgaGVhdExheWVyOiBMLkhlYXRMYXllclxuXG4gIHByaXZhdGUgc2VnbWVudGVkTWluOiBudW1iZXJcbiAgcHJpdmF0ZSBzZWdtZW50ZWRTdGVwOiBudW1iZXJcbiAgY29uc3RydWN0b3IoXG4gICAgbWFwOiBMLk1hcCxcbiAgICBkYXRhTGlzdDogRGF0YUxpc3RJdGVtW10sXG4gICAgb3B0aW9uczogTWFya2Vyc0xheWVyT3B0aW9ucyxcbiAgICBjaGFubmVsRnVuYzogQ2hhbm5lbEZ1bmNcbiAgKSB7XG4gICAgdGhpcy5tYXAgPSBtYXBcbiAgICB0aGlzLmRhdGFMaXN0ID0gZGF0YUxpc3RcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zXG4gICAgdGhpcy5jaGFubmVsRnVuYyA9IGNoYW5uZWxGdW5jXG5cbiAgICB0aGlzLmxheWVyID0gbnVsbFxuICAgIHRoaXMuZm9jdXNlZE1hcmtlciA9IG51bGxcbiAgICB0aGlzLmhvdmVyZWRNYXJrZXIgPSBudWxsXG4gICAgdGhpcy5mb2N1c2VkRGlzcGxheU1hcmtlciA9IG51bGxcbiAgICB0aGlzLm1hcmtlcnMgPSBbXVxuICAgIHRoaXMubWFya2VyTGF5ZXIgPSBudWxsXG4gICAgdGhpcy5oZWF0TGF5ZXIgPSBudWxsXG5cbiAgICB0aGlzLnNlZ21lbnRlZE1pbiA9IEluZmluaXR5XG4gICAgdGhpcy5zZWdtZW50ZWRTdGVwID0gMVxuXG4gICAgdGhpcy5pbml0TGF5ZXIoKVxuICB9XG4gIHB1YmxpYyBkcmF3KG9wdGlvbnM/OiBNYXJrZXJzTGF5ZXJPcHRpb25zKSB7XG4gICAgcmV0dXJuIHRoaXMucmVkcmF3KG9wdGlvbnMpXG4gIH1cbiAgcHVibGljIHJlZHJhdyhvcHRpb25zPzogTWFya2Vyc0xheWVyT3B0aW9ucykge1xuICAgIGlmICh0aGlzLmxheWVyKSB7XG4gICAgICB0aGlzLmxheWVyLnJlbW92ZUZyb20odGhpcy5tYXApXG4gICAgfVxuICAgIHRoaXMub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24odGhpcy5vcHRpb25zLCBvcHRpb25zKVxuICAgIHN3aXRjaCAodGhpcy5vcHRpb25zLnJlbmRlclR5cGUpIHtcbiAgICAgIGNhc2UgJ3BvaW50Jzoge1xuICAgICAgICB0aGlzLnJlbmRlck1hcmtlclRvUG9pbnQoKVxuICAgICAgICBicmVha1xuICAgICAgfVxuICAgICAgY2FzZSAnaGVhdCc6IHtcbiAgICAgICAgdGhpcy5yZW5kZXJNYXJrZXJUb0hlYXQoKVxuICAgICAgICBicmVha1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYHJlbmRlclR5cGUg5LiN5pSv5oyBXCIke3RoaXMub3B0aW9ucy5yZW5kZXJUeXBlfVwiYClcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5sYXllci5hZGRUbyh0aGlzLm1hcClcbiAgICByZXR1cm4gdGhpc1xuICB9XG4gIHB1YmxpYyBzZXRPcHRpb25zKG9wdGlvbnM6IE1hcmtlcnNMYXllck9wdGlvbnMsIHJlZHJhdyA9IGZhbHNlKSB7XG4gICAgdGhpcy5vcHRpb25zID0gT2JqZWN0LmFzc2lnbih0aGlzLm9wdGlvbnMsIG9wdGlvbnMpXG4gICAgaWYgKHJlZHJhdykge1xuICAgICAgdGhpcy5yZWRyYXcoKVxuICAgIH1cbiAgfVxuICBwcml2YXRlIGluaXRMYXllcigpIHtcbiAgICB0aGlzLmRhdGFMaXN0LmZvckVhY2goKGRhdGEpID0+IHtcbiAgICAgIGNvbnN0IGxheWVyID0gTC5nZW9KU09OKGRhdGEuZ2VvbWV0cnkpLmdldExheWVycygpWzBdXG4gICAgICBsZXQgbWFya2VyID0gbGF5ZXIgYXMgTWFya2VyXG5cbiAgICAgIG1hcmtlciA9IG5ldyBNYXJrZXIoW21hcmtlci5nZXRMYXRMbmcoKS5sbmcsIG1hcmtlci5nZXRMYXRMbmcoKS5sYXRdLCB7XG4gICAgICAgIGljb246IHRoaXMuZ2V0TWFya2VySWNvbihkYXRhKSxcbiAgICAgIH0pXG5cbiAgICAgIC8vIOWwhuebuOWFs+WAvOe7keWumuWIsCBtYXJrZXLkuIpcbiAgICAgIG1hcmtlci5zZXREYXRhKGRhdGEpXG5cbiAgICAgIHRoaXMubWFya2Vycy5wdXNoKG1hcmtlcilcblxuICAgICAgLy8g57yT5a2YIHNlZ21lbnQg55u45YWz5pWw5o2uXG4gICAgICB0aGlzLmNhY2hlU2VnbWVudFBhcmFtcygpXG4gICAgfSlcbiAgfVxuICAvLyDlpITnkIYgbWFya2VyIOeCueWHu+S6i+S7tlxuICBwcml2YXRlIG1hcmtlckNsaWNrSGFuZGxlcihtYXJrZXI6IE1hcmtlcikge1xuICAgIHRoaXMuZm9jdXNlZE1hcmtlciA9IG1hcmtlclxuICAgIC8vIOWIoOmZpOWJjeS4gOS4quaUvuWkp+Wbvuagh1xuICAgIGlmICh0aGlzLmZvY3VzZWREaXNwbGF5TWFya2VyKSB7XG4gICAgICB0aGlzLmZvY3VzZWREaXNwbGF5TWFya2VyLnJlbW92ZUZyb20odGhpcy5tYXApXG4gICAgfVxuICAgIC8vIOeUn+aIkOW9k+WJjeaUvuWkp+Wbvuagh1xuICAgIHRoaXMuZm9jdXNlZERpc3BsYXlNYXJrZXIgPSBuZXcgTWFya2VyKG1hcmtlci5nZXRMYXRMbmcoKSwge1xuICAgICAgaWNvbjogdGhpcy5nZXRMYXJnZXJNYXJrZXJJY29uKG1hcmtlci5nZXREYXRhKCkpLFxuICAgIH0pXG4gICAgdGhpcy5mb2N1c2VkRGlzcGxheU1hcmtlci5hZGRUbyh0aGlzLm1hcClcblxuICAgIHRoaXMubWFwLnBhblRvKHRoaXMuZm9jdXNlZE1hcmtlci5nZXRMYXRMbmcoKSlcbiAgICB0aGlzLmNoYW5uZWxGdW5jKCdvbi1jbGljay1tYXJrZXInLCBtYXJrZXIpXG4gIH1cblxuICAvKiog5riy5p+T5Li65pWj54K55Zu+ICovXG4gIHByaXZhdGUgcmVuZGVyTWFya2VyVG9Qb2ludCgpIHtcbiAgICBjb25zdCBjYW52YXNJY29uTGF5ZXIgPSBMLmNhbnZhc0ljb25MYXllcih7fSkuYWRkVG8odGhpcy5tYXApXG4gICAgLy8g5re75Yqg54K55Ye75LqL5Lu2XG4gICAgY2FudmFzSWNvbkxheWVyLmFkZE9uQ2xpY2tMaXN0ZW5lcigoXywgW3sgZGF0YTogbWFya2VyIH1dKSA9PiB7XG4gICAgICB0aGlzLm1hcmtlckNsaWNrSGFuZGxlcihtYXJrZXIgYXMgTWFya2VyKVxuICAgIH0pXG4gICAgLy8g5re75YqgIGhvdmVyIOS6i+S7tlxuICAgIGNhbnZhc0ljb25MYXllci5hZGRPbkhvdmVyTGlzdGVuZXIoKF8sIFt7IGRhdGE6IG1hcmtlciB9XSkgPT4ge1xuICAgICAgLy8g5LmL5YmN5pyJIGhvdmVyIOeahOWFs+mXrSB0b29sdGlwXG4gICAgICBpZiAodGhpcy5ob3ZlcmVkTWFya2VyKSB7XG4gICAgICAgIHRoaXMuaG92ZXJlZE1hcmtlci5jbG9zZVRvb2x0aXAoKVxuICAgICAgfVxuICAgICAgdGhpcy5ob3ZlcmVkTWFya2VyID0gbWFya2VyIGFzIE1hcmtlclxuXG4gICAgICBpZiAodGhpcy5ob3ZlcmVkTWFya2VyLmdldFRvb2x0aXAoKSkge1xuICAgICAgICAvLyDlpoLmnpzlt7Lnu4/orr7nva4gdG9vbHRpcCDnm7TmjqXlsZXnpLogdG9vbHRpcFxuICAgICAgICB0aGlzLmhvdmVyZWRNYXJrZXIub3BlblRvb2x0aXAoKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8g5ZCm5YiZ57uR5a6aIHRvb2x0aXAg5bm25bGV56S6XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMudG9vbHRpcEF0dHIpIHtcbiAgICAgICAgICB0aGlzLmhvdmVyZWRNYXJrZXIuYmluZFRvb2x0aXAoXG4gICAgICAgICAgICAnJyArIHRoaXMuaG92ZXJlZE1hcmtlci5nZXREYXRhKClbdGhpcy5vcHRpb25zLnRvb2x0aXBBdHRyXSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgcGVybWFuZW50OiB0cnVlLFxuICAgICAgICAgICAgfVxuICAgICAgICAgIClcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG4gICAgY2FudmFzSWNvbkxheWVyLmFkZE1hcmtlcnModGhpcy5tYXJrZXJzKVxuICAgIHRoaXMubWFwLnBhblRvKHRoaXMubWFwLmdldENlbnRlcigpKVxuICAgIHRoaXMubWFya2VyTGF5ZXIgPSBjYW52YXNJY29uTGF5ZXJcbiAgICB0aGlzLmxheWVyID0gdGhpcy5tYXJrZXJMYXllclxuICB9XG5cbiAgLyoqIOa4suafk+S4uueDreWKm+WbviAqL1xuICBwcml2YXRlIHJlbmRlck1hcmtlclRvSGVhdCgpIHtcbiAgICB0aGlzLm1hcmtlcnMuZm9yRWFjaCgobWFya2VyKSA9PiB7XG4gICAgICBjb25zdCBsYXRMbmcgPSBtYXJrZXIuZ2V0TGF0TG5nKClcbiAgICAgIGxldCBhbHQgPSBtYXJrZXIuZ2V0RGF0YSgpW3RoaXMub3B0aW9ucy5oZWF0T3B0aW9ucy5kaW1lbnNpb25BdHRyXVxuICAgICAgaWYgKHR5cGVvZiBhbHQgIT09ICdudW1iZXInKSB7XG4gICAgICAgIGFsdCA9IHRoaXMub3B0aW9ucy5oZWF0T3B0aW9ucy5tYXhcbiAgICAgIH1cbiAgICAgIG1hcmtlci5zZXRMYXRMbmcoTC5sYXRMbmcobGF0TG5nLmxhdCwgbGF0TG5nLmxuZywgYWx0KSlcbiAgICB9KVxuICAgIHRoaXMuaGVhdExheWVyID0gTC5oZWF0TGF5ZXIoXG4gICAgICB0aGlzLm1hcmtlcnMubWFwKChpdCkgPT4gaXQuZ2V0TGF0TG5nKCkpLFxuICAgICAgdGhpcy5vcHRpb25zLmhlYXRPcHRpb25zXG4gICAgKVxuICAgIHRoaXMubGF5ZXIgPSB0aGlzLmhlYXRMYXllclxuICB9XG5cbiAgcHJpdmF0ZSBnZXRMYXJnZXJNYXJrZXJJY29uKGRhdGE6IERhdGFMaXN0SXRlbSkge1xuICAgIHJldHVybiB0aGlzLl9nZXRNYXJrZXJJY29uKGRhdGEsIHRydWUpXG4gIH1cblxuICBwcml2YXRlIGdldE1hcmtlckljb24oZGF0YTogRGF0YUxpc3RJdGVtKSB7XG4gICAgcmV0dXJuIHRoaXMuX2dldE1hcmtlckljb24oZGF0YSwgZmFsc2UpXG4gIH1cblxuICAvKiog6I635Y+W5b2T5YmNIG1hcmtlciDpnIDopoHlsZXnpLrnmoQgaWNvbiAqL1xuICBwcml2YXRlIF9nZXRNYXJrZXJJY29uKFxuICAgIGRhdGE6IERhdGFMaXN0SXRlbSxcbiAgICBpc0xhcmdlcjogYm9vbGVhblxuICApOiBMLkljb24gfCBMLkRpdkljb24ge1xuICAgIGxldCBpY29uU2l6ZSA9IHRoaXMub3B0aW9ucy5pY29uU2l6ZVxuICAgIGxldCBpY29uQW5jaG9yID0gdGhpcy5vcHRpb25zLmljb25BbmNob3JcbiAgICBpY29uU2l6ZSA9IGlzTGFyZ2VyID8gW2ljb25TaXplWzBdICogMS41LCBpY29uU2l6ZVsxXSAqIDEuNV0gOiBpY29uU2l6ZVxuICAgIGljb25BbmNob3IgPSBpc0xhcmdlclxuICAgICAgPyBbaWNvbkFuY2hvclswXSAqIDEuNSwgaWNvbkFuY2hvclsxXSAqIDEuNV1cbiAgICAgIDogaWNvbkFuY2hvclxuXG4gICAgY29uc3QgaWNvbkNvbG9yID0gdGhpcy5vcHRpb25zLmljb25Db2xvclxuXG4gICAgc3dpdGNoICh0aGlzLm9wdGlvbnMuaWNvblR5cGUpIHtcbiAgICAgIGNhc2UgJ2ltYWdlJzoge1xuICAgICAgICByZXR1cm4gTC5pY29uKHtcbiAgICAgICAgICBpY29uVXJsOiB0aGlzLm9wdGlvbnMuaWNvbkltYWdlVXJsLFxuICAgICAgICAgIGljb25TaXplLFxuICAgICAgICAgIGljb25BbmNob3IsXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgICBjYXNlICdmb250X2NsYXNzJzpcbiAgICAgIGNhc2UgJ3N5bWJvbCc6XG4gICAgICBjYXNlICd1bmljb2RlJzoge1xuICAgICAgICByZXR1cm4gTC5kaXZJY29uKHtcbiAgICAgICAgICBodG1sOiB0aGlzLmdldEN1c3RvbUljb25IVE1MKGRhdGEsIHtcbiAgICAgICAgICAgIGljb25TaXplLFxuICAgICAgICAgICAgaWNvbkNvbG9yLFxuICAgICAgICAgIH0pLFxuICAgICAgICAgIGNsYXNzTmFtZTogaXNMYXJnZXIgPyAnbGFyZ2UtZGl2LWljb24tbWFya2VyJyA6ICcnLFxuICAgICAgICAgIGljb25TaXplLFxuICAgICAgICAgIGljb25BbmNob3IsXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihg5Zu+5qCH57G75Z6L5LiN5pSv5oyBXCIke3RoaXMub3B0aW9ucy5pY29uVHlwZX1cImApXG4gICAgICB9XG4gICAgfVxuICB9XG4gIHByaXZhdGUgZ2V0Q3VzdG9tSWNvbkhUTUwoXG4gICAgZGF0YTogRGF0YUxpc3RJdGVtLFxuICAgIG9wdGlvbnM/OiBJY29uUmVuZGVyRnVuY09wdGlvblxuICApOiBzdHJpbmcge1xuICAgIGlmICh0aGlzLm9wdGlvbnMuaWNvblJlbmRlcmVyKSB7XG4gICAgICBvcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5vcHRpb25zLCBvcHRpb25zKVxuICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5pY29uUmVuZGVyZXIoZGF0YSwgb3B0aW9ucylcbiAgICB9XG4gICAgc3dpdGNoICh0aGlzLm9wdGlvbnMucmVuZGVyUG9pbnRDb2xvclR5cGUpIHtcbiAgICAgIGNhc2UgJ3NpbmdsZSc6IHtcbiAgICAgICAgc3dpdGNoICh0aGlzLm9wdGlvbnMuaWNvblR5cGUpIHtcbiAgICAgICAgICAvLyDkvb/nlKggY2xhc3NcbiAgICAgICAgICBjYXNlICdmb250X2NsYXNzJzoge1xuICAgICAgICAgICAgcmV0dXJuIGBcbiAgICAgICAgICAgICAgPGkgY2xhc3M9XCIke3RoaXMub3B0aW9ucy5pY29uQ2xhc3N9XCJcbiAgICAgICAgICAgICAgICBzdHlsZT1cIlxuICAgICAgICAgICAgICAgICAgY29sb3I6ICR7b3B0aW9ucy5pY29uQ29sb3J9O1xuICAgICAgICAgICAgICAgICAgZm9udC1zaXplOiAke29wdGlvbnMuaWNvblNpemV9cHg7XG4gICAgICAgICAgICAgICAgXCJcbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgYFxuICAgICAgICAgIH1cbiAgICAgICAgICAvLyDkvb/nlKggc3ZnXG4gICAgICAgICAgY2FzZSAnc3ltYm9sJzoge1xuICAgICAgICAgICAgcmV0dXJuIGBcbiAgICAgICAgICAgICAgPHN2ZyBjbGFzcz1cImljb24tc3ltYm9sXCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+XG4gICAgICAgICAgICAgICAgPHVzZSB4bGluazpocmVmPVwiJHt0aGlzLm9wdGlvbnMuaWNvblN5bWJvbH1cIiAvPlxuICAgICAgICAgICAgICA8L3N2Zz5cbiAgICAgICAgICAgIGBcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8g5L2/55SoIHVuaWNvZGVcbiAgICAgICAgICBjYXNlICd1bmljb2RlJzoge1xuICAgICAgICAgICAgcmV0dXJuIGBcbiAgICAgICAgICAgICAgPGlcbiAgICAgICAgICAgICAgICBjbGFzcz1cIiR7dGhpcy5vcHRpb25zLmljb25DbGFzc31cIlxuICAgICAgICAgICAgICAgIHN0eWxlPVwiXG4gICAgICAgICAgICAgICAgICBjb2xvcjogJHtvcHRpb25zLmljb25Db2xvcn07XG4gICAgICAgICAgICAgICAgICBmb250LXNpemU6ICR7b3B0aW9ucy5pY29uU2l6ZVswXX1weDtcbiAgICAgICAgICAgICAgICBcIlxuICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAke3RoaXMub3B0aW9ucy5pY29uVW5pY29kZX1cbiAgICAgICAgICAgICAgPC9pPlxuICAgICAgICAgICAgYFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY2FzZSAnc2VnbWVudGVkJzoge1xuICAgICAgICBzd2l0Y2ggKHRoaXMub3B0aW9ucy5pY29uVHlwZSkge1xuICAgICAgICAgIC8vIOS9v+eUqCBjbGFzc1xuICAgICAgICAgIGNhc2UgJ2ZvbnRfY2xhc3MnOiB7XG4gICAgICAgICAgICByZXR1cm4gYFxuICAgICAgICAgICAgICA8aVxuICAgICAgICAgICAgICAgIGNsYXNzPVwiJHt0aGlzLm9wdGlvbnMuaWNvbkNsYXNzfVwiXG4gICAgICAgICAgICAgICAgc3R5bGU9XCJcbiAgICAgICAgICAgICAgICAgIGNvbG9yOiAke3RoaXMuZ2V0U2VnbWVudGVkTWFya2VyQ29sb3IoZGF0YSl9O1xuICAgICAgICAgICAgICAgICAgZm9udC1zaXplOiAke29wdGlvbnMuaWNvblNpemV9cHg7XG4gICAgICAgICAgICAgICAgXCJcbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgYFxuICAgICAgICAgIH1cbiAgICAgICAgICAvLyDkvb/nlKggc3ZnXG4gICAgICAgICAgY2FzZSAnc3ltYm9sJzoge1xuICAgICAgICAgICAgcmV0dXJuIGBcbiAgICAgICAgICAgICAgPHN2ZyBjbGFzcz1cImljb24tc3ltYm9sXCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+XG4gICAgICAgICAgICAgICAgPHVzZSB4bGluazpocmVmPVwiJHt0aGlzLm9wdGlvbnMuaWNvblN5bWJvbH1cIiAvPlxuICAgICAgICAgICAgICA8L3N2Zz5cbiAgICAgICAgICAgIGBcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8g5L2/55SoIHVuaWNvZGVcbiAgICAgICAgICBjYXNlICd1bmljb2RlJzoge1xuICAgICAgICAgICAgcmV0dXJuIGBcbiAgICAgICAgICAgICAgPGlcbiAgICAgICAgICAgICAgICBjbGFzcz1cIiR7dGhpcy5vcHRpb25zLmljb25DbGFzc31cIlxuICAgICAgICAgICAgICAgIHN0eWxlPVwiXG4gICAgICAgICAgICAgICAgICBjb2xvcjogJHt0aGlzLmdldFNlZ21lbnRlZE1hcmtlckNvbG9yKGRhdGEpfTtcbiAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogJHtvcHRpb25zLmljb25TaXplfXB4O1xuICAgICAgICAgICAgICAgIFwiXG4gICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICYjJHt0aGlzLm9wdGlvbnMuaWNvblVuaWNvZGV9XG4gICAgICAgICAgICAgIDwvaT5cbiAgICAgICAgICAgIGBcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGByZW5kZXJQb2ludENvbG9yVHlwZSDkuI3mlK/mjIFcIiR7dGhpcy5vcHRpb25zLnJlbmRlclBvaW50Q29sb3JUeXBlfVwiYFxuICAgICAgICApXG4gICAgICB9XG4gICAgfVxuICB9XG4gIHByaXZhdGUgY2FjaGVTZWdtZW50UGFyYW1zKCkge1xuICAgIGNvbnN0IHNlZ21lbnRlZExlbmd0aCA9IHRoaXMub3B0aW9ucy5zZWdtZW50ZWRDb2xvcnMubGVuZ3RoXG4gICAgbGV0IG1heFZhbCA9IC1JbmZpbml0eVxuICAgIGxldCBtaW5WYWwgPSBJbmZpbml0eVxuICAgIGZvciAoY29uc3QgbWFya2VyIG9mIHRoaXMubWFya2Vycykge1xuICAgICAgY29uc3QgdmFsID0gbWFya2VyLmdldERhdGEoKVt0aGlzLm9wdGlvbnMuc2VnbWVudGVkQXR0cl1cbiAgICAgIG1heFZhbCA9IE1hdGgubWF4KG1heFZhbCwgdmFsKVxuICAgICAgbWluVmFsID0gTWF0aC5taW4obWluVmFsLCB2YWwpXG4gICAgfVxuICAgIGNvbnN0IHN0ZXAgPSAobWF4VmFsIC0gbWluVmFsICsgMSkgLyBzZWdtZW50ZWRMZW5ndGhcbiAgICB0aGlzLnNlZ21lbnRlZE1pbiA9IG1pblZhbFxuICAgIHRoaXMuc2VnbWVudGVkU3RlcCA9IHN0ZXBcbiAgfVxuICBwcml2YXRlIGdldFNlZ21lbnRlZE1hcmtlckNvbG9yKGRhdGE6IERhdGFMaXN0SXRlbSk6IHN0cmluZyB7XG4gICAgY29uc3QgdmFsID0gZGF0YVt0aGlzLm9wdGlvbnMuc2VnbWVudGVkQXR0cl1cbiAgICBjb25zdCBjb2xvciA9IHRoaXMub3B0aW9ucy5zZWdtZW50ZWRDb2xvcnNbXG4gICAgICAodmFsIC0gdGhpcy5zZWdtZW50ZWRNaW4pIC8gdGhpcy5zZWdtZW50ZWRTdGVwXG4gICAgXVxuICAgIHJldHVybiBjb2xvclxuICB9XG59XG4iXSwic291cmNlUm9vdCI6IiJ9